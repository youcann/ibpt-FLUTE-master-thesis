\chapter{Introduction}
In this thesis methods to improve the stability of the electron gun of the \gls{flute} accelerator are studied.

\Gls{flute} is a \gls{thz} photon source based on a \gls{linac} and is currently under commission at the \gls{kit}. It aims to be a source of high field \gls{thz} pulses (up to \SI{1200}{\mega\volt\per\meter}) in the femtosecond range, provide a test facility for accelerator research and an injection device for \gls{cstart} (see \cite{SchaeferHaererPapash2019_1000091183}) in the future. \cite{Naknaimueang:2011zz}

The accelerator is designed for a final electron momentum of \SI{41}{\MeV\per c} and bunch charges of \SIrange{1}{3000}{\pico\coulomb} with lengths of \SIrange{1}{300}{\fs}. The bunches are emitted with a repetition frequency of up to \SI{10}{\hertz}. \cite{Malygin2018}

\autoref{fig:fluteEgun-flutePaper} shows the finished accelerator schematically. Is mainly consists of the low energy section, the \gls{linac}, the four-dipole bunch compressor and several diagnostic instruments.\\
Along with several diagnostic devices, the low energy section contains the electron gun that pre-accelerates electrons to \SI{7}{\MeV\per c}. The electrons are generated at the cathode inside the gun photo-electrically through stimulation with \gls{uv} radiation (\SI{270}{\nm}) generated by a Ti:Sa laser. After that a solenoid is used to focus the electron beam for injection into the \gls{linac} section. The \gls{linac}, a 156-cell traveling wave structure, is then used to accelerate the electrons to \SI{41}{\MeV\per c}. With a setup of four dipole magnets, the bunches are compressed longitudinally before the last dipole is used to generate \gls{csr} and \gls{cer} for \gls{thz} experiments. Another way of generating \gls{thz} pulses is to use a metal target, with a specific working function, that is hit by the electron bunch. \cite{Nasse:IPAC13-WEPWA010}

At the time of writing, the low energy section is fully operational and at the end, a Faraday cup is installed as a beam dump to measure the electron bunch charges. It has to be removed when the \gls{linac} section is commissioned.

\begin{figure}[tb]
	\centering
	\includegraphics[width=\textwidth]{chap/StabilityOfTheElectronGun/img/flutePaper.png}
	\caption[FLUTE schematic with all components]{Schematic of the finished accelerator showing all installed and planned components (reprinted from \cite{Yan2018})}
	\label{fig:fluteEgun-flutePaper}
\end{figure}

Scientific experiments, such as \gls{thz} spectroscopy, rely on a known and stable wavelength of the \gls{thz} radiation. As the \gls{thz} radiation is emitted from a metal target by the photo effect after being hit by the electron bunches or by interaction with a magnetic field, the wavelength and the wavelength stability of the \gls{thz} photons depend on the energy and the energy stability of the electrons.
Also as \gls{flute} being a test facility, adding and changing out components, possibly developed by other research institutes, is a common routine. To ensure compatibility among these components, reliable beam parameters at the interfaces between them are necessary. These parameters include the beams position in the $x$- and $y$-direction, the beam steering angle, the electron energy, the emittance and the charge of the bunch and its dimensions. Since focusing and steering of the beam is done with electromagnets, it is also effected by the electron energy, as the deflection of an electron in a magnetic field is a function of its velocity, so ultimately its energy.

Besides depending on the wavelength of the \gls{uv} pulses hitting the cathode, the electron energies also strongly dependent of the  on the geometrical, electrical and thermal characteristics of the electron gun and its \gls{rf} power supply. These characteristics are not independent of each other and variations of them can have a multitude of intrinsic or extrinsic causes.

To improve the stability of the electron energy, in this thesis these causes are analyzed and measures against them or their effects are developed. Eventually this leads to the design of a \textit{closed}-loop control system. 

This approach is different from past efforts to improve the stability, which primarily treated the stability of (sub-) components that supply the electron gun. For instance, instabilities due to temperature variations were dealt with by stabilizing the water cooling system of the electron gun, or disturbances from the pulse forming network were reduced by improving the power supply. These measures can be thought of changes to an \textit{open}-loop. This is because there is no feeding back of the success or error from the system output, the electron energy, to the water cooler or power supply. Hence for these improvements to work, deep knowledge of the relation between the components and their effect on the electron energy is required. Also if parameters of the components change due to aging, environmental factors, such as temperature or noise on the mains power, these effects can be carried over to the electron energy.

These are the main two reasons that motivate a closed-loop approach. It is often not required to know the exact relationships between certain input disturbances and the electron energy. Most of the times qualitative descriptions or correlations are sufficient, at least as a starting point, to achieve sufficiently good rejection of the disturbances. And with a closed-loop the system can react to changes of system parameters without the need for manual modifications.

That is why in the following chapter such a closed-loop control system for the \gls{flute} electron gun is treated in detail. In order to design an appropriate control system, some prerequisites are needed. First the present disturbances are analyzed and metrics to later measure the favorable effect of the control system are defined. Then ways of connecting the finished control system to the existing hard- and software are shown. With this preliminary work done, the control system can be designed. After the design process, the whole system is simulated on a computer to verify the solution, before the control system is implemented and tested with the real hardware, i.e. at \gls{flute}.

